<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <canvas id="canvas"></canvas>
</body>
<script type="module">
    import { initShaders } from "./utils/utils.js"
    import Poly from "./utils/Poly.js"
    import { OrthographicCamera , Matrix4, PerspectiveCamera } from "https://unpkg.com/three/build/three.module.js"
    const VSHADER_SOURCE = `
        attribute vec4 a_Position;
        uniform mat4 u_ProjectionMatrix;
        void main() {
            gl_Position = u_ProjectionMatrix * a_Position; // 设置坐标位置
        }
    `
    const FSHADER_SOURCE = `
        precision mediump float;
        uniform vec4 u_Color;
        void main(){
            gl_FragColor = u_Color; // 设置颜色
        }
    `
    canvas.width= window.innerWidth;
    canvas.height= window.innerHeight;
    // 获取WebGL绘图上下文
    const gl = canvas.getContext('webgl');
    initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)
    // 指定清空canvas的颜色
    gl.clearColor(0, 0, 0, 1);
    // 清空canvas
    gl.clear(gl.COLOR_BUFFER_BIT);

    const [fov, aspect, near, far] = [
        45,
        canvas.width / canvas.height,
        1,
        20
    ]
    const camera = new PerspectiveCamera(fov, aspect, near, far)
    console.log(new Matrix4().setPosition(-0.5, 0, -3).elements);
    const triangle1 = crtTriangle(
        [1, 0, 0, 1],
        [-0.5,0,-3]
    )

    const triangle2 = crtTriangle(
        [1, 0, 0, 1],
        [0.5,0,-3]
    )

    const triangle3 = crtTriangle(
        [1, 1, 0, 1],
        [-0.5,0,-2]
    )

    const triangle4 = crtTriangle(
        [1, 1, 0, 1],
        [0.5,0,-2]
    )

    render()
    function render() {
        gl.clear(gl.COLOR_BUFFER_BIT);

        triangle1.init()
        triangle1.draw()

        triangle2.init()
        triangle2.draw()

        triangle3.init()
        triangle3.draw()

        triangle4.init()
        triangle4.draw()
    }

    function crtTriangle(color, [x,y,z]) {
        return new Poly({
            gl,
            source: [
                x, 0.3+y, z,
                -0.3+x, -0.3+y, z,
                0.3+x, -0.3+y, z,
            ],
            type: 'TRIANGLES',
            attributes: {
                a_Position: {
                    size: 3,
                    index: 0
                },
            },
            uniforms: {
                u_Color: {
                    type: 'uniform4fv',
                    value: color
                },
                u_ProjectionMatrix: {
                    type: 'uniformMatrix4fv',
                    value: camera.projectionMatrix.elements
                },
            }
        })
    }
</script>
</html>