<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
</body>
<script type="module">
    import { Scene, Group, Matrix4, Object3D, Vector3, Euler, Quaternion } from "https://unpkg.com/three/build/three.module.js"
    const OC2 = new Vector3(3,2,1).normalize()
    const angle = 2
    const p1 = new Vector3(1,2,3)

    {
        // 计算OC2旋转多少度和ozx共面
        const B2OB1 = Math.atan2(OC2.y, OC2.z)
        const mx1 = new Matrix4().makeRotationX(B2OB1)
        const mx2 = new Matrix4().makeRotationX(-B2OB1)

        // 计算旋转到平面ozx的轴OC3
        const OC3 = OC2.clone().applyMatrix4(mx1)

        // 计算旋转多少度旋转到Z轴
        const C3OB1 = Math.atan2(OC3.x, OC3.z)
        const my1 = new Matrix4().makeRotationY(-C3OB1)
        const my2 = new Matrix4().makeRotationY(C3OB1)

        // 让点P1同样做等量旋转得到p2
        const p2 = p1.clone().applyMatrix4(mx1).applyMatrix4(my1)

        // 计算绕z轴旋转矩阵
        const mz = new Matrix4().makeRotationZ(angle)

        // 让p2绕z轴旋转
        p2.applyMatrix4(mz)

        // 让p2在逆向旋转回去
        p2.applyMatrix4(my2)
        p2.applyMatrix4(mx2)
        console.log(p2);
    }
    {
        const quaternion = new Quaternion()
        quaternion.setFromAxisAngle(OC2, angle)
        const m = new Matrix4()
        m.makeRotationFromQuaternion(quaternion)
        console.log(p1.clone().applyMatrix4(m));
    }
</script>
</html>