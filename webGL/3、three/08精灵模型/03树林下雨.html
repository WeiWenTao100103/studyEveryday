<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    body{
        margin: 0;
    }
</style>
<body>
    
</body>
<script type="module">
    import {
        Scene,
        BoxGeometry,
        MeshLambertMaterial,
        Mesh,
        PointLight,
        AmbientLight,
        OrthographicCamera,
        PerspectiveCamera,
        WebGLRenderer,
        SphereGeometry,
        CylinderGeometry,
        AxesHelper,
        BufferGeometry,
        BufferAttribute,
        MeshBasicMaterial,
        DoubleSide,
        Vector3,
        Color,
        VertexColors,
        PointsMaterial,
        Points,
        Line,
        LineDashedMaterial,
        PlaneGeometry,
        DirectionalLight,
        SpotLight,
        Group,
        ArcCurve,
        TextureLoader,
        ImageLoader,
        Texture,
        SpriteMaterial,
        Sprite
    } from 'https://unpkg.com/three/build/three.module.js'
    import {OrbitControls} from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/OrbitControls.js'
    //创建一个场景对象。
    const scene = new Scene() 


    const textureLoader = new TextureLoader()
    const textureGrass = textureLoader.load('../../image/grass.jpeg')
    const geometry = new PlaneGeometry(400,300)
    const material = new MeshLambertMaterial({
        // color: 0x777700,
        map: textureGrass
    })
    const mesh = new Mesh(geometry, material)
    mesh.rotateX(-Math.PI/2)
    scene.add(mesh)

    const textureTree = textureLoader.load('../../image/tree.png')
    const materialTree = new SpriteMaterial({
        map: textureTree
    })
    for (let i = 0; i < 50; i++) {
        const x = Math.random()*380-200
        const z = Math.random()*280-150
        const tree = new Sprite(materialTree)
        tree.scale.set(60, 60, 60)
        tree.position.set(x,30,z)
        scene.add(tree)
        
    }

    const textureRain = textureLoader.load("../../image/rain.png")
    const materialRain = new SpriteMaterial({
        map: textureRain
    })
    const rainGroup = new Group()
    console.log(rainGroup);

    scene.add(rainGroup)
    for (let i = 0; i < 500; i++) {
        const x = Math.random()*380-200
        const y = Math.random()*150+50
        const z = Math.random()*280-150
        const sprite = new Sprite(materialRain)
        sprite.scale.set(10, 10, 10)
        sprite.position.set(x,y,z)
        rainGroup.add(sprite)
    }
    
    

    const point = new PointLight(0xffffff)
    point.position.set(500, 500, 500)
    scene.add(point)
    const ambient = new AmbientLight(0x333333)
    // 将环境光添加到场景中
    scene.add(ambient)

    const width = window.innerWidth
    const height = window.innerHeight
    const camera = new PerspectiveCamera(80, width/height, 1, 1000) 
    camera.lookAt(scene.position)
    camera.position.set(40, 80, 100)

    // 初始化渲染构造器
    const renderer =new WebGLRenderer()
    // 设置输出画布大小
    renderer.setSize(width, height)
    // 设置清除画布的颜色
    renderer.setClearColor(0x000000, 1)
    document.body.appendChild(renderer.domElement)

    // 创建一个定长的辅助坐标系
    const axesHelper = new AxesHelper(500)
    scene.add(axesHelper)

    function render() {
        renderer.render(scene, camera)
        rainGroup.children.forEach(rain=>{
            rain.position.y-=1
            if (rain.position.y<=0) {
                rain.position.y = 200
            }
        })
        requestAnimationFrame(render)
    }
    render()
    
    const controls = new OrbitControls(camera, renderer.domElement)
</script>
</html>